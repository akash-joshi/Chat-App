<meta name="viewport" content="width=device-width, initial-scale=1.0">
<html>

<head>
  <title>Socket.IO chat</title>
  <link href="style.css" rel="stylesheet" />
</head>

<body>

  <form id="login" action="">
    Enter username :
    <input autocomplete="on" id="user" required /><input id="usersubmit" type=submit button>
  </form>
  <span class="mainwrapper">
    <ul id="messages"></ul>
    <ul id="online"></ul>
    <div id="sendform">
    	<form action="">
      		<input id="m" autocomplete="on" /><button>Send</button>
    	</form>
    </div>
  </span>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
  <script>
    $(function() {

      var prev;
      var socket = io();
      var ready = false;
      console.log(0);
      $("#sendform").hide();
      $('#login').show();
      $("#login").submit(function(event) {
        event.preventDefault();
      });

      $('#usersubmit').click(function() {
        if ($('#user').val().replace(/\s/g, ''))
          var nick = $('#user').val();
        socket.emit("join", nick);
        $("#sendform").show();
        $('#login').hide();
      });

      $("#sendform").submit(function() {
        if ($('#m').val() == '')
          return false;
        socket.emit('chat message', $('#m').val());
        $('#m').val('');
        return false;
      });

      socket.on("update", function(msg) {
        $('#messages').append('<li id="update" >' + msg);
      });

      socket.on("people-list", function(people) {
        var x;
        for (x in people) {
          $('#online').append('<li>' + people[x]);
        }
      });

      socket.on("disconnect", function() {
        $('#messages').append("<li id=\"update\">You have lost connection to server. Refresh Page to restore connection.");
        $('#sendform').hide();
      });
      socket.on('chat message', function(nick, msg) {
        if (prev == nick) {
          $('#messages li:last-child > div').append("<div>" + msg + "</div>");
        } else {
          $('#messages').append("<li> <strong>" + nick + "</strong> : " + "<div id=\"innermsg\">" + msg + "</div></li>");
        }

        prev = nick;
        $("#messages").animate({
          scrollTop: $('#messages').prop("scrollHeight")
        }, 100);
      });


    });
  </script>

</body>

</html>
